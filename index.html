<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë””ì§€í„¸ ì„œë°”ì´ë²Œ ì±Œë¦°ì§€</title>
    <!-- Tailwind CSS ë¡œë“œ --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter í°íŠ¸ ë¡œë“œ --><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- html2canvas ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ (HTML ìš”ì†Œë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜í•˜ê¸° ìœ„í•´ ì‚¬ìš©) --><script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Noto Sans KR í°íŠ¸ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì‚¬ìš©í•˜ë˜, Inter í°íŠ¸ë„ fallbackìœ¼ë¡œ ì§€ì • */
        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
        }
        /* ë²„íŠ¼ í´ë¦­ ì‹œ ë¯¸ì„¸í•œ íš¨ê³¼ */
        .btn-choice {
            transition: all 0.1s ease-in-out;
        }
        .btn-choice:active {
            transform: scale(0.98);
            opacity: 0.9;
        }
        /* ì‹œë‚˜ë¦¬ì˜¤ í…ìŠ¤íŠ¸ê°€ ìì—°ìŠ¤ëŸ½ê²Œ ë‚˜íƒ€ë‚˜ë„ë¡ */
        .scenario-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ë°°ì§€ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes bounceIn {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }

        .badge-animation {
            animation: bounceIn 1s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">

    <div id="game-container" class="w-full max-w-md bg-gray-800 rounded-2xl shadow-2xl overflow-hidden">
        
        <!-- 1. ì´ˆê¸° ì§„ì… í™”ë©´ (Splash Screen) --><div id="splash-screen" class="p-8 text-center flex flex-col items-center justify-center min-h-[500px] bg-gray-900">
            <h2 class="text-4xl font-extrabold text-indigo-400 mb-4">ë””ì§€í„¸ ì„œë°”ì´ë²Œ ì±Œë¦°ì§€</h2>
            <p class="text-xl text-gray-300 mb-10">ë””ì§€í„¸ ì„¸ìƒ ì†ì—ì„œ ì•ˆì „í•˜ê²Œ ì‚´ì•„ë‚¨ìœ¼ì„¸ìš”!</p>
            <button id="start-game-button" class="w-2/3 bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-6 rounded-xl text-lg transition duration-150 transform hover:scale-105 btn-choice shadow-lg">
                ê²Œì„ ì‹œì‘í•˜ê¸°
            </button>
        </div>

        <!-- í—¤ë”: íƒ€ì´í‹€, ì§„í–‰ ìƒí™© ë° ì ìˆ˜ --><header id="game-header" class="p-4 bg-gray-700 border-b border-gray-600 flex justify-between items-center hidden">
            <!-- ì§„í–‰ ìƒí™© í‘œì‹œê¸° --><div id="progress-indicator" class="text-sm font-semibold text-gray-400 pt-3">ë¬¸ì œ 1/8</div> 
            <div class="text-right">
                <span class="text-xs text-gray-400 block">ì•ˆì „ ì ìˆ˜</span>
                <div class="flex items-center justify-end">
                    <span id="score" class="text-2xl font-bold text-green-400">100</span>
                    <!-- ì ìˆ˜ ë³€í™” íš¨ê³¼ í‘œì‹œê¸° --><span id="score-change-effect" class="text-lg font-extrabold ml-2 opacity-0 transition-opacity duration-300 ease-in-out"></span>
                </div>
            </div>
        </header>

        <!-- ê²Œì„ í™”ë©´ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) --><main id="scenario-container" class="p-6 min-h-[350px] flex flex-col justify-between scenario-fade-in hidden">
            <!-- ì‹œë‚˜ë¦¬ì˜¤ ë‚´ìš© --><div>
                <div id="scenario-icon" class="text-4xl mb-4"></div>
                <p id="scenario-text" class="text-lg text-gray-200 leading-relaxed mb-6"></p>
            </div>
            
            <!-- ì„ íƒì§€ ë²„íŠ¼ --><div id="options-container" class="space-y-3">
                <!-- JSë¡œ ë™ì  ìƒì„± --></div>
        </main>

        <!-- í”¼ë“œë°± í™”ë©´ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) --><footer id="feedback-container" class="p-6 bg-gray-800 border-t border-gray-600 hidden">
            <p id="feedback-text" class="text-base mb-4"></p>
            <button id="next-button" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg btn-choice">
                ë‹¤ìŒìœ¼ë¡œ
            </button>
        </footer>

        <!-- ê²Œì„ ì¢…ë£Œ í™”ë©´ (ì´ˆê¸°ì—ëŠ” ìˆ¨ê¹€) --><div id="end-game-container" class="p-8 text-center hidden">
            <h2 id="end-game-title" class="text-3xl font-bold mb-4"></h2>
            
            <!-- ë°°ì§€ í‘œì‹œ ì˜ì—­ (ë‹¤ìš´ë¡œë“œ ëŒ€ìƒì´ ë˜ëŠ” ì˜ì—­) --><div id="badge-display" class="my-6 p-2 rounded-xl bg-gray-700 shadow-xl border-2 border-indigo-500">
                <!-- ë‹¤ìš´ë¡œë“œ ì‹œ í°ìƒ‰ ë°°ê²½ì„ ê°–ë„ë¡ ë‚´ë¶€ div ì¶”ê°€ --><div id="badge-export-area" class="p-6 rounded-lg bg-white text-gray-800">
                    <!-- ë°°ì§€ ë‚´ìš©ì´ ì—¬ê¸°ì— ì‚½ì…ë©ë‹ˆë‹¤. (JSë¡œ ì±„ì›Œì§) --></div>
            </div>

            <p id="end-game-message" class="text-lg text-gray-300 mb-6"></p>

            <!-- ë°°ì§€ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ --><button id="download-badge-button" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg transition duration-150 transform hover:scale-105 btn-choice mb-4">
                ğŸ† ë°°ì§€ ë‹¤ìš´ë¡œë“œ (PNG)
            </button>
            
            <!-- ë‹¤ì‹œ ì‹œì‘ ë²„íŠ¼ --><button id="restart-button" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition duration-150 transform hover:scale-105 btn-choice">
                ë‹¤ì‹œ ë„ì „í•˜ê¸°
            </button>
        </div>

        <!-- ì €ì‘ê¶Œ í‘œì‹œ (Copyright Notice) --><footer class="text-xs text-gray-500 text-center p-3 border-t border-gray-700">
            &copy; 2025 peace_shiny. All rights reserved.
        </footer>

    </div>

    <script>
        // --- ì„¤ì • ë° DOM ìš”ì†Œ ---
        const STARTING_SCORE = 100; // ğŸ’¡ ì‹œì‘ ì ìˆ˜ì…ë‹ˆë‹¤.
        
        // DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const splashScreen = document.getElementById('splash-screen');
        const startGameButton = document.getElementById('start-game-button');
        const gameHeader = document.getElementById('game-header');
        
        const scoreElement = document.getElementById('score');
        const progressIndicator = document.getElementById('progress-indicator');
        const scoreChangeEffect = document.getElementById('score-change-effect');

        const scenarioContainer = document.getElementById('scenario-container');
        const scenarioIcon = document.getElementById('scenario-icon');
        const scenarioText = document.getElementById('scenario-text');
        const optionsContainer = document.getElementById('options-container');
        const feedbackContainer = document.getElementById('feedback-container');
        const feedbackText = document.getElementById('feedback-text');
        const nextButton = document.getElementById('next-button');
        const endGameContainer = document.getElementById('end-game-container');
        const endGameTitle = document.getElementById('end-game-title');
        const endGameMessage = document.getElementById('end-game-message');
        const badgeDisplay = document.getElementById('badge-display');
        const badgeExportArea = document.getElementById('badge-export-area');
        const downloadBadgeButton = document.getElementById('download-badge-button');
        const restartButton = document.getElementById('restart-button');

        let currentScore = STARTING_SCORE;
        let currentScenarioId = 1;

        // ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° (ì´ì „ê³¼ ë™ì¼)
        const scenarios = {
            1: {
                icon: 'ğŸ¤”',
                text: "ìƒˆë¡œìš´ ì†Œì…œ ë¯¸ë””ì–´ 'ì¸ì‹¸ê·¸ë¨'ì— ê°€ì…í•˜ë ¤ê³  í•œë‹¤. í”„ë¡œí•„ì„ ì–´ë–»ê²Œ ë§Œë“¤ê¹Œ?",
                options: [
                    { text: "ì‹¤ëª…, í•™êµ, ì–¼êµ´ ì‚¬ì§„ê¹Œì§€ ì™„ë²½ ê³µê°œ!", consequence: "ì•ˆ ë¼! ëª¨ë¥´ëŠ” ì‚¬ëŒì—ê²Œ ë‚´ ê°œì¸ì •ë³´ê°€ ë‹¤ ë…¸ì¶œë¼. ë²”ì£„ì— ì´ìš©ë  ìˆ˜ ìˆì–´!", scoreChange: -20, nextId: 2 },
                    { text: "ë³„ëª…ê³¼ ì¢‹ì•„í•˜ëŠ” ìºë¦­í„° ì•„ë°”íƒ€ë¡œ ì„¤ì •í•œë‹¤.", consequence: "ì¢‹ì€ ì„ íƒì´ì•¼! ì˜¨ë¼ì¸ì—ì„  ë‚˜ë¥¼ íŠ¹ì •í•  ìˆ˜ ìˆëŠ” ì •ë³´ëŠ” ìµœì†Œí•œë§Œ ê³µê°œí•˜ëŠ” ê²Œ ì•ˆì „í•´.", scoreChange: +10, nextId: 2 }
                ]
            },
            2: {
                icon: 'ğŸ®',
                text: "ê²Œì„ì„ í•˜ëŠ”ë° ëª¨ë¥´ëŠ” ìœ ì €ì—ê²Œì„œ DMì´ ì™”ë‹¤. '[ê¸´ê¸‰] OOê²Œì„ í¬ê·€ ìŠ¤í‚¨ ë¬´ë£Œ ì¦ì •! ì•„ë˜ ë§í¬ í´ë¦­!'",
                options: [
                    { text: "ì´ê±´ ëª» ì°¸ì§€! ë‹¹ì¥ í´ë¦­í•´ì„œ ìŠ¤í‚¨ ë°›ëŠ”ë‹¤.", consequence: "í´ë¦­í•˜ëŠ” ìˆœê°„... ë‚´ ê³„ì •ì€ í•´í‚¹ë‹¹í–ˆë‹¤! ë¹„ë°€ë²ˆí˜¸ì™€ ì•„ì´í…œì´ ëª¨ë‘ í„¸ë ¸ë‹¤. ì´ê±´ í”¼ì‹± ë§í¬ì˜€ì–´.", scoreChange: -30, nextId: 3 },
                    { text: "ì„¸ìƒì— ê³µì§œëŠ” ì—†ë‹¤. ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ë§í¬ëŠ” ì ˆëŒ€ í´ë¦­í•˜ì§€ ì•Šê³  ì‹ ê³ /ì°¨ë‹¨í•œë‹¤.", consequence: "í˜„ëª…í•œ íŒë‹¨! í”¼ì‹± ì‚¬ê¸°ë¥¼ í”¼í–ˆë‹¤. ë‚´ ì •ë³´ëŠ” ì†Œì¤‘í•˜ë‹ˆê¹Œ.", scoreChange: +10, nextId: 3 }
                ]
            },
            3: {
                icon: 'ğŸ¬',
                text: "ë‹¨í†¡ë°©ì— 'ìš°ë¦¬ë°˜ ë‹´ì„ìŒ¤ì´ êµì‹¤ì—ì„œ ì¶¤ì¶”ëŠ”' ì˜ìƒì´ ì˜¬ë¼ì™”ë‹¤. ì—„ì²­ ì›ƒê¸´ë°... ì™ ì§€ ì–¼êµ´ì´ë‘ ëª©ì†Œë¦¬ê°€ ë”°ë¡œ ë…¸ëŠ” ê²ƒ ê°™ë‹¤.",
                options: [
                    { text: "ã…‹ã…‹ã…‹ ëŒ€ë°•! ë‹¤ë¥¸ ë°˜ ì¹œêµ¬ë“¤ì—ê²Œë„ ë§ˆêµ¬ ê³µìœ í•œë‹¤.", consequence: "ì´ê±´ 'ë”¥í˜ì´í¬' ì˜ìƒì´ì—ˆë‹¤. ì„ ìƒë‹˜ì˜ ëª…ì˜ˆë¥¼ í›¼ì†í•˜ëŠ” 2ì°¨ ê°€í•´ì— ë™ì°¸í•œ ì…ˆì´ì•¼. ë””ì§€í„¸ ì„±ë²”ì£„ê°€ ë  ìˆ˜ ìˆì–´!", scoreChange: -30, nextId: 4 },
                    { text: "ì´ê±° ë”¥í˜ì´í¬ ê°™ì€ë°? ì›ë³¸ ì˜ìƒì¸ì§€ í™•ì¸í•˜ê³ , ì¹œêµ¬ë“¤ì—ê²Œë„ í¼ëœ¨ë¦¬ì§€ ë§ë¼ê³  ë§í•œë‹¤.", consequence: "í›Œë¥­í•œ ë””ì§€í„¸ ì‹œë¯¼! ë”¥í˜ì´í¬ë¥¼ ì‹ë³„í•˜ê³  ë¬´ë¶„ë³„í•œ í™•ì‚°ì„ ë§‰ì•˜ë‹¤.", scoreChange: +15, nextId: 4 }
                ]
            },
            4: {
                icon: 'ğŸ“±',
                text: "ì¹œêµ¬ê°€ ë‚´ í°ì„ ì ê¹ ë¹Œë ¤ê°€ë”ë‹ˆ 'ì¬ë¯¸ìˆëŠ” í…ŒìŠ¤íŠ¸'ë¼ë©° ì•±ì„ í•˜ë‚˜ ê¹”ì•„ì¤¬ë‹¤. ê·¸ëŸ°ë° ì•±ì´ 'ì „í™”ë²ˆí˜¸ë¶€ ì ‘ê·¼'ê³¼ 'ìœ„ì¹˜ ì •ë³´'ë¥¼ ìš”êµ¬í•œë‹¤.",
                options: [
                    { text: "ì¹œêµ¬ê°€ ì¶”ì²œí•œ ê±´ë° ë­. 'ëª¨ë‘ í—ˆìš©' ëˆ„ë¥¸ë‹¤.", consequence: "ìœ„í—˜í•´! ì´ ì•±ì´ ë‚´ ëª¨ë“  ì—°ë½ì²˜ì™€ ì´ë™ ê²½ë¡œë¥¼ ìˆ˜ì§‘í•´ ê´‘ê³  íšŒì‚¬ì— íŒ”ì•„ë„˜ê¸¸ ìˆ˜ë„ ìˆì–´. í•„ìš”í•œ ê¶Œí•œë§Œ í—ˆìš©í•´ì•¼ í•´.", scoreChange: -20, nextId: 5 },
                    { text: "í…ŒìŠ¤íŠ¸ ì•±ì´ ì™œ ë‚´ ì£¼ì†Œë¡ì´ í•„ìš”í•˜ì§€? ê¶Œí•œì„ ê±°ë¶€í•˜ê³  ì•±ì„ ì‚­ì œí•œë‹¤.", consequence: "ì •í™•í•´! ì•±ì´ ìš”êµ¬í•˜ëŠ” ê¶Œí•œì´ ê¸°ëŠ¥ê³¼ ë¬´ê´€í•˜ë‹¤ë©´ ì˜ì‹¬í•´ì•¼ í•´. ë‚´ ì •ë³´ ì§€í‚´ì´!", scoreChange: +10, nextId: 5 }
                ]
            },
            5: {
                icon: 'ğŸ’¬',
                text: "ì¸ê¸° ìœ íŠœë²„ ë¼ì´ë¸Œ ë°©ì†¡. ì±„íŒ…ì°½ì—ì„œ ëª‡ëª‡ ì‚¬ëŒë“¤ì´ í•œ ëª…ì„ ì§€ëª©í•˜ë©° ì™¸ëª¨ë¥¼ ë¹„í•˜í•˜ê³  'ë‚˜ê°€ ì£½ì–´ë¼' ë“±ì˜ ì•…í”Œì„ ë‹¬ê³  ìˆë‹¤.",
                options: [
                    { text: "ì¬ë°ŒëŠ”ë°? ë‚˜ë„ í•œë§ˆë”” ê±°ë“ ë‹¤. (ì•…í”Œ ë™ì°¸)", consequence: "ì‚¬ì´ë²„ë¶ˆë§(ì–¸ì–´í­ë ¥)ì€ ëª…ë°±í•œ ë²”ì£„ë‹¤. ìµëª…ì„±ì— ìˆ¨ì–´ ë‚¨ì„ ê³µê²©í•˜ëŠ” ê²ƒì€ ë¹„ê²í•œ í–‰ë™ì´ì•¼.", scoreChange: -30, nextId: 6 }, 
                    { text: "ëª» ë³¸ ì²™ ë¬´ì‹œí•œë‹¤.", consequence: "ë°©ê´€ë„ í­ë ¥ì— í˜ì„ ì‹¤ì–´ì¤„ ìˆ˜ ìˆì–´. ì¡°ê¸ˆ ë” ìš©ê¸°ë¥¼ ë‚´ë³´ì.", scoreChange: -5, nextId: 6 }, 
                    { text: "ì±„íŒ…ì„ ìº¡ì²˜í•´ì„œ ì‹ ê³ í•˜ê³ , í”¼í•´ìë¥¼ ì‘ì›í•˜ëŠ” ë©”ì‹œì§€ë¥¼ ë³´ë‚¸ë‹¤.", consequence: "ì •ì˜ë¡œìš´ í–‰ë™! ì‚¬ì´ë²„ë¶ˆë§ì„ ë©ˆì¶”ëŠ” 'ì„ í•œ ì˜í–¥ë ¥'ì„ ë³´ì—¬ì¤¬ë‹¤. ë‹¹ì‹ ì´ ì§„ì •í•œ ë””ì§€í„¸ ì‹œë¯¼!", scoreChange: +20, nextId: 6 } 
                ]
            },
            6: {
                icon: 'ğŸ”‘',
                text: "ìì£¼ ì“°ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í•´í‚¹ë‹¹í–ˆë‹¤ëŠ” ë¬¸ìë¥¼ ë°›ì•˜ë‹¤. í˜¹ì‹œ ëª°ë¼ í™•ì¸í•´ë³´ë‹ˆ, ë‚´ê°€ ì‚¬ìš©í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸ íŒ¨í„´ì´ ìœ ì¶œ ëª©ë¡ì— í¬í•¨ë˜ì–´ ìˆë‹¤.",
                options: [
                    { text: "ì–´ì°¨í”¼ í•´í‚¹ëœ ê¹€ì—... ëª¨ë“  ì‚¬ì´íŠ¸ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë˜‘ê°™ì´ ìœ ì§€í•œë‹¤.", consequence: "ë§¤ìš° ìœ„í—˜í•œ ìƒê°! í•œ ì‚¬ì´íŠ¸ê°€ ëš«ë¦¬ë©´ ëª¨ë“  ê°œì¸ ì •ë³´ê°€ ìœ ì¶œë  ìˆ˜ ìˆì–´. ë¹„ë°€ë²ˆí˜¸ëŠ” ì‚¬ì´íŠ¸ë³„ë¡œ ë‹¤ë¥´ê²Œ ì„¤ì •í•´ì•¼ í•´.", scoreChange: -25, nextId: 7 },
                    { text: "ë‹¹ì¥ ëª¨ë“  ì¤‘ìš”í•œ ì‚¬ì´íŠ¸ì˜ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë°”ê¾¸ê³ , ì‚¬ì´íŠ¸ë§ˆë‹¤ ë‹¤ë¥¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•œë‹¤.", consequence: "ì™„ë²½í•œ ëŒ€ì‘! ê·€ì°®ë”ë¼ë„ ì—¬ëŸ¬ ì‚¬ì´íŠ¸ì— ë‹¤ë¥¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒì€ ë””ì§€í„¸ ì•ˆì „ì˜ ê¸°ë³¸ì´ì•¼.", scoreChange: +15, nextId: 7 }
                ]
            },
            7: {
                icon: 'ğŸ“°',
                text: "ì¹œí•œ ì¹œêµ¬ê°€ í†¡ìœ¼ë¡œ 'ì´ë²ˆ ì„ ê±°ì—ì„œ OOOOí•˜ë©´ ì ˆëŒ€ ì•ˆ ë˜ëŠ” ì´ìœ 'ë¼ëŠ” ìê·¹ì ì¸ ì œëª©ì˜ ìœ íŠœë¸Œ ì‡¼ì¸ ë¥¼ ë³´ëƒˆë‹¤. ë‚´ìš©ì´ ë„ˆë¬´ ì¶©ê²©ì ì´ë‹¤.",
                options: [
                    { text: "ë„ˆë¬´ ì¶©ê²©ì ì´ë¼ ì¹œêµ¬ ë§ë§Œ ë¯¿ê³  ë‚´ìš©ì„ ë°”ë¡œ ê³µìœ í•œë‹¤.", consequence: "ì ê¹! ìê·¹ì ì¸ ì •ë³´ì¼ìˆ˜ë¡ ê°€ì§œë‰´ìŠ¤ì¼ ê°€ëŠ¥ì„±ì´ ë†’ì•„. ë‚´ìš©ì„ ê³µìœ í•˜ê¸° ì „ì— ì‚¬ì‹¤ ê´€ê³„ë¥¼ í™•ì¸í•˜ì§€ ì•Šìœ¼ë©´ ë‚˜ë„ ê°€ì§œë‰´ìŠ¤ ìœ í¬ìê°€ ë¼.", scoreChange: -15, nextId: 8 },
                    { text: "ëŒ“ê¸€ ì°½ë¶€í„° í™•ì¸í•˜ê³ , ë‹¤ë¥¸ ë‰´ìŠ¤ ë§¤ì²´ë‚˜ ê³µì‹ ê¸°ê´€ì—ì„œ ì‚¬ì‹¤ì„ í™•ì¸í•´ ë³¸ë‹¤.", consequence: "í›Œë¥­í•œ ì •ë³´ ë¶„ë³„ë ¥! ë¯¸ë””ì–´ë¥¼ ë¬´ë¹„íŒì ìœ¼ë¡œ ìˆ˜ìš©í•˜ì§€ ì•Šê³  ì‚¬ì‹¤ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ë ¤ëŠ” íƒœë„ê°€ ì¤‘ìš”í•´.", scoreChange: +10, nextId: 8 }
                ]
            },
            8: {
                icon: 'ğŸ˜´',
                text: "ë°¤ëŠ¦ê²Œê¹Œì§€ í•¸ë“œí°ì„ ë³´ë‹¤ê°€ ë‹¤ìŒë‚  ìˆ˜ì—… ì‹œê°„ì— ì¡¸ê³  ìˆë‹¤. ì„ ìƒë‹˜ì´ 'ë””ì§€í„¸ ê¸°ê¸° ì‚¬ìš© ì‹œê°„ì„ ì¡°ì ˆí•´ì•¼ í•œë‹¤'ê³  ì¶©ê³ í•˜ì…¨ë‹¤.",
                options: [
                    { text: "ë‚´ ë§ˆìŒëŒ€ë¡œ í•  ê±°ì•¼'ë¼ë©° ì˜¤íˆë ¤ ë°¤ìƒ˜ ê²Œì„ì„ ë” í•œë‹¤.", consequence: "ë””ì§€í„¸ ê¸°ê¸° ì¤‘ë…ì€ ì‹ ì²´ ê±´ê°•ë¿ë§Œ ì•„ë‹ˆë¼ ì§‘ì¤‘ë ¥ê¹Œì§€ í•´ì¹  ìˆ˜ ìˆì–´. ê±´ê°•í•œ ìƒí™œ ìŠµê´€ì´ í•„ìš”í•´.", scoreChange: -10, nextId: 'end' },
                    { text: "íœ´ëŒ€í° ì•±ì˜ ìˆ˜ë©´ ëª¨ë“œë¥¼ ì„¤ì •í•˜ê³ , ì ë“¤ê¸° í•œ ì‹œê°„ ì „ì—ëŠ” ê¸°ê¸°ë¥¼ ë©€ë¦¬ ë‘”ë‹¤.", consequence: "í˜„ëª…í•œ ìê¸° í†µì œ! ë””ì§€í„¸ ë””í†¡ìŠ¤ë¥¼ í†µí•´ ìˆ™ë©´ì„ ì·¨í•˜ê³  ë‹¤ìŒë‚  í™œê¸°ì°¬ ìƒí™œì„ í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆì–´.", scoreChange: +10, nextId: 'end' }
                ]
            }
        };

        // ë°°ì§€ ë°ì´í„° (ì´ë¯¸ì§€ URLì„ ì›ë³¸ ì½˜í…ì¸ (raw.githubusercontent.com) URLë¡œ ë³€ê²½)
        const badges = {
            MASTER: {
                imageUrl: 'https://raw.githubusercontent.com/shinyrumi/students_digital/615cb7148cf5b589941504899fb6e95ad45d657b/%EC%99%95.png',
                name: 'ë””ì§€í„¸ ìƒì¡´ì™•',
                description: 'ìµœê³ ì˜ ì ìˆ˜! ëª¨ë“  ë””ì§€í„¸ ìœ„í˜‘ìœ¼ë¡œë¶€í„° ìì‹ ì„ ì™„ë²½í•˜ê²Œ ë³´í˜¸í•  ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì„ ì¦ëª…í–ˆìŠµë‹ˆë‹¤.',
                color: 'text-yellow-600'
            },
            EXCELLENT: {
                imageUrl: 'https://raw.githubusercontent.com/shinyrumi/students_digital/615cb7148cf5b589941504899fb6e95ad45d657b/%EB%B3%B4%EC%95%88%EA%B4%80.png',
                name: 'ë””ì§€í„¸ ë³´ì•ˆê´€',
                description: 'ë§¤ìš° í›Œë¥­í•œ ì ìˆ˜! ëŒ€ë¶€ë¶„ì˜ ìœ„í—˜ì„ í”¼í–ˆì§€ë§Œ, ëª‡ ê°€ì§€ ì•„ì‰¬ìš´ ì„ íƒì´ ìˆì—ˆìŠµë‹ˆë‹¤. ë‹¤ìŒì—” ë§Œì ì„ ë…¸ë ¤ë³´ì„¸ìš”!',
                color: 'text-indigo-600'
            },
            DANGER: {
                imageUrl: 'https://raw.githubusercontent.com/shinyrumi/students_digital/615cb7148cf5b589941504899fb6e95ad45d657b/%EB%B3%91%EC%95%84%EB%A6%AC.png',
                name: 'ë””ì§€í„¸ ìƒˆì‹¹',
                description: 'ì•„ì§ì€ ìœ„í—˜ì— ë…¸ì¶œë˜ê¸° ì‰½ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ê´œì°®ìŠµë‹ˆë‹¤! ì´ ê²½í—˜ìœ¼ë¡œ ë¬´ì—‡ì„ ì¡°ì‹¬í•´ì•¼ í• ì§€ ë°°ì› ìŠµë‹ˆë‹¤.',
                color: 'text-red-600'
            }
        };

        // ìŠ¤í”Œë˜ì‹œ í™”ë©´ í‘œì‹œ
        function showSplashScreen() {
            splashScreen.classList.remove('hidden');
            gameHeader.classList.add('hidden');
            scenarioContainer.classList.add('hidden');
            feedbackContainer.classList.add('hidden');
            endGameContainer.classList.add('hidden');
            downloadBadgeButton.onclick = downloadBadge; 
        }

        // ê²Œì„ ì‹œì‘ í•¨ìˆ˜
        function startGame() {
            splashScreen.classList.add('hidden');
            gameHeader.classList.remove('hidden');

            currentScore = STARTING_SCORE;
            currentScenarioId = 1;
            scoreElement.textContent = currentScore;
            
            scenarioContainer.classList.remove('hidden');
            scenarioContainer.style.display = 'flex';
            
            feedbackContainer.classList.add('hidden');
            endGameContainer.classList.add('hidden');
            
            scoreElement.classList.remove('text-red-400', 'text-yellow-400');
            scoreElement.classList.add('text-green-400');

            showScenario(currentScenarioId);
        }

        // ì‹œë‚˜ë¦¬ì˜¤ í‘œì‹œ í•¨ìˆ˜ (ì´ì „ê³¼ ë™ì¼)
        function showScenario(id) {
            const scenario = scenarios[id];
            
            if (!scenario) {
                showEndGame();
                return;
            }

            // ì§„í–‰ ìƒí™© ì—…ë°ì´íŠ¸
            const totalScenarios = Object.keys(scenarios).length;
            progressIndicator.textContent = `ë¬¸ì œ ${id}/${totalScenarios}`;
            
            scenarioContainer.classList.remove('scenario-fade-in');
            void scenarioContainer.offsetWidth; 
            scenarioContainer.classList.add('scenario-fade-in');

            scenarioIcon.textContent = scenario.icon;
            scenarioText.textContent = scenario.text;

            optionsContainer.innerHTML = '';

            scenario.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option.text;
                button.className = 'w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg btn-choice';
                
                if (index === 1) {
                    button.classList.replace('bg-indigo-600', 'bg-gray-600');
                    button.classList.replace('hover:bg-indigo-700', 'hover:bg-gray-500');
                }
                if (index === 2) {
                    button.classList.replace('bg-indigo-600', 'bg-teal-600');
                    button.classList.replace('hover:bg-indigo-700', 'hover:bg-teal-500');
                }

                button.onclick = () => selectOption(option);
                optionsContainer.appendChild(button);
            });

            scenarioContainer.classList.remove('hidden');
            scenarioContainer.style.display = 'flex'; 
            feedbackContainer.classList.add('hidden');
            endGameContainer.classList.add('hidden');
        }

        // ì„ íƒì§€ ì„ íƒ í•¨ìˆ˜ (ì´ì „ê³¼ ë™ì¼)
        function selectOption(option) {
            scoreChangeEffect.textContent = (option.scoreChange > 0 ? '+' : '') + option.scoreChange;
            scoreChangeEffect.classList.remove('text-green-400', 'text-red-400', 'opacity-0');
            scoreChangeEffect.classList.add(option.scoreChange > 0 ? 'text-green-400' : 'text-red-400', 'opacity-100');
            
            setTimeout(() => {
                scoreChangeEffect.classList.remove('opacity-100');
                scoreChangeEffect.classList.add('opacity-0');
            }, 500);

            currentScore += option.scoreChange;
            scoreElement.textContent = currentScore;

            if (currentScore <= 70) {
                scoreElement.classList.remove('text-green-400', 'text-yellow-400');
                scoreElement.classList.add('text-red-400');
            } else if (currentScore <= 90) {
                scoreElement.classList.remove('text-green-400', 'text-red-400');
                scoreElement.classList.add('text-yellow-400');
            } else {
                scoreElement.classList.remove('text-yellow-400', 'text-red-400');
                scoreElement.classList.add('text-green-400');
            }

            feedbackText.textContent = option.consequence;
            if (option.scoreChange > 0) {
                feedbackText.classList.add('text-green-400');
                feedbackText.classList.remove('text-red-400');
            } else {
                feedbackText.classList.add('text-red-400');
                feedbackText.classList.remove('text-green-400');
            }

            currentScenarioId = option.nextId;

            scenarioContainer.classList.add('hidden');
            feedbackContainer.classList.remove('hidden');

            if (currentScenarioId === 'end') {
                nextButton.textContent = 'ê²°ê³¼ í™•ì¸í•˜ê¸°';
                nextButton.onclick = showEndGame;
            } else {
                nextButton.textContent = 'ë‹¤ìŒìœ¼ë¡œ';
                nextButton.onclick = () => showScenario(currentScenarioId);
            }
        }

        // ê²Œì„ ì¢…ë£Œ í™”ë©´ í‘œì‹œ (ë°°ì§€ ê¸°ëŠ¥ ì¶”ê°€)
        function showEndGame() {
            gameHeader.classList.add('hidden');
            feedbackContainer.classList.add('hidden');
            endGameContainer.classList.remove('hidden');
            
            const masterThreshold = STARTING_SCORE + 50;
            const lowThreshold = STARTING_SCORE - 20;

            let resultBadge;
            let resultText;

            if (currentScore >= masterThreshold) {
                resultBadge = badges.MASTER;
                endGameTitle.textContent = 'ğŸ† ë””ì§€í„¸ ë§ˆìŠ¤í„° ğŸ†';
                endGameTitle.classList.remove('text-yellow-400', 'text-red-400');
                endGameTitle.classList.add('text-green-400');
                resultText = `ë‹¹ì‹ ì˜ ë””ì§€í„¸ ì•ˆì „ ì ìˆ˜: ${currentScore}ì . ì™„ë²½í•´ìš”! ë‹¹ì‹ ì€ ë”¥í˜ì´í¬ë„ ê°€ë ¤ë‚´ê³  ê°œì¸ì •ë³´ë„ ì§€í‚¬ ì¤„ ì•„ëŠ” ì§„ì •í•œ ë””ì§€í„¸ ì‹œë¯¼ì…ë‹ˆë‹¤!`;
            } else if (currentScore > lowThreshold) {
                resultBadge = badges.EXCELLENT;
                endGameTitle.textContent = 'ğŸ‘ ë””ì§€í„¸ ìš°ë“±ìƒ ğŸ‘';
                endGameTitle.classList.remove('text-green-400', 'text-red-400');
                endGameTitle.classList.add('text-yellow-400');
                resultText = `ë‹¹ì‹ ì˜ ë””ì§€í„¸ ì•ˆì „ ì ìˆ˜: ${currentScore}ì . í›Œë¥­í•´ìš”! ëª‡ ê°€ì§€ë§Œ ë” ì¡°ì‹¬í•˜ë©´ ì™„ë²½í•˜ê² ì–´ìš”. ë””ì§€í„¸ ì„¸ìƒì˜ ìœ„í—˜ì„ ì˜ ì•Œê³  ìˆë„¤ìš”!`;
            } else {
                resultBadge = badges.DANGER;
                endGameTitle.textContent = 'ğŸš¨ ë””ì§€í„¸ ìœ„í—˜! ğŸš¨';
                endGameTitle.classList.remove('text-green-400', 'text-yellow-400');
                endGameTitle.classList.add('text-red-400');
                resultText = `ë‹¹ì‹ ì˜ ë””ì§€í„¸ ì•ˆì „ ì ìˆ˜: ${currentScore}ì . ìœ„í—˜í•´ìš”! í•˜ì§€ë§Œ ê´œì°®ìŠµë‹ˆë‹¤. ì´ë²ˆ ê²Œì„ì„ í†µí•´ ë¬´ì—‡ì„ ì¡°ì‹¬í•´ì•¼ í• ì§€ ë°°ì› ìœ¼ë‹ˆ, ë‹¤ìŒì—” ë” ì˜í•  ìˆ˜ ìˆì„ ê±°ì˜ˆìš”!`;
            }

            endGameMessage.textContent = resultText;
            
            // --- ë°°ì§€ í‘œì‹œ ë¡œì§ (badge-export-areaì— ì‚½ì…) ---
            badgeExportArea.innerHTML = `
                <div class="text-center">
                    <img src="${resultBadge.imageUrl}" alt="${resultBadge.name} ë°°ì§€" class="w-24 h-24 mx-auto mb-2 object-contain badge-animation">
                    <h3 class="text-2xl font-extrabold mb-1 ${resultBadge.color}">${resultBadge.name}</h3>
                    <p class="text-sm text-gray-600 mt-2">${resultBadge.description}</p>
                </div>
            `;
        }

        /**
         * HTML2Canvasë¥¼ ì‚¬ìš©í•˜ì—¬ ë°°ì§€ í‘œì‹œ ì˜ì—­ì„ PNG ì´ë¯¸ì§€ë¡œ ë³€í™˜í•˜ì—¬ ë‹¤ìš´ë¡œë“œí•©ë‹ˆë‹¤.
         */
        function downloadBadge() {
            downloadBadgeButton.textContent = '... ì´ë¯¸ì§€ ìƒì„± ì¤‘ ...';
            downloadBadgeButton.disabled = true;

            const element = document.getElementById('badge-export-area'); 

            html2canvas(element, { 
                scale: 3, 
                useCORS: true, // ì™¸ë¶€ ì´ë¯¸ì§€ ë¡œë“œë¥¼ ìœ„í•´ CORS ì‚¬ìš©
                backgroundColor: '#ffffff' 
            }).then(canvas => {
                const imageURL = canvas.toDataURL('image/png');

                const link = document.createElement('a');
                link.href = imageURL;
                link.download = `ë””ì§€í„¸_ìƒì¡´_ë°°ì§€_${currentScore}ì .png`;
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                downloadBadgeButton.textContent = 'ğŸ† ë°°ì§€ ë‹¤ìš´ë¡œë“œ (PNG)';
                downloadBadgeButton.disabled = false;
            }).catch(error => {
                console.error("ë°°ì§€ ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨:", error);
                // raw.githubusercontent.com ë§í¬ë¥¼ ì‚¬ìš©í–ˆìœ¼ë¯€ë¡œ ì—ëŸ¬ ë°œìƒ ê°€ëŠ¥ì„±ì´ ë‚®ì•„ì¡Œì§€ë§Œ, ë§Œì•½ì„ ëŒ€ë¹„í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                alert("ë°°ì§€ ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. CORS ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ ì´ë¯¸ì§€ URLì„ ìˆ˜ì •í–ˆì§€ë§Œ, ì—¬ì „íˆ ë¬¸ì œê°€ ë°œìƒí•˜ë©´ GitHub ì €ì¥ì†Œì˜ ì„¤ì •(í¼ë¯¸ì…˜)ì„ í™•ì¸í•´ ì£¼ì„¸ìš”."); 
                downloadBadgeButton.textContent = 'ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨';
                downloadBadgeButton.disabled = false;
            });
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        restartButton.onclick = startGame;
        startGameButton.onclick = startGame;
        downloadBadgeButton.onclick = downloadBadge;

        // ì´ˆê¸° í™”ë©´ í‘œì‹œ (ê²Œì„ ì‹œì‘ ëŒ€ì‹  ìŠ¤í”Œë˜ì‹œ í™”ë©´ì„ ë¨¼ì € ë³´ì—¬ì¤Œ)
        window.onload = showSplashScreen;

    </script>
</body>
</html>
